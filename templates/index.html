<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css?v={{ CSS_VERSION }}">
</head>
<body>
    <div class="container">
        <div class="content-box">
            <h1>üìù –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–º–µ—Ç–æ–∫</h1>

            <div class="form-section">
                <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</h2>
                <form id="addNoteForm" action="/notes/create" method="post" class="form-row">
                    <input type="text" name="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏" required>
                    <input type="text" name="content" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏" required>
                    <button type="submit" class="btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>

            <div class="form-section">
                <h2>üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –ø–æ ID</h2>
                <form id="deleteByIdForm" action="/notes/deleteID" method="post" class="form-row">
                    <input type="number" name="note_id" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–º–µ—Ç–∫–∏" required>
                    <button type="submit" class="btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>

            <div class="form-section">
                <h2>‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –ø–æ ID</h2>
                <form action="/notes/update_ID" method="post" class="form-row">
                    <input type="text" name="title" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" required>
                    <input type="text" name="content" placeholder="–ù–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ" required>
                    <input type="number" name="note_id" placeholder="ID –∑–∞–º–µ—Ç–∫–∏" required>
                    <button type="submit" class="btn-success">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </form>
            </div>

            <div class="form-section">
                <h2>üîç –ù–∞–π—Ç–∏ –∑–∞–º–µ—Ç–∫—É –ø–æ ID</h2>
                <form action="/notes/search" method="get" class="form-row">
                    <input type="number" name="note_id" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–º–µ—Ç–∫–∏" required>
                    <button type="submit">–ù–∞–π—Ç–∏</button>
                </form>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number">{{ notes|length }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–º–µ—Ç–æ–∫</div>
                </div>
            </div>

            <div class="nav-links">
                <a href="/notes/stats" class="nav-link">üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="http://127.0.0.1:8000/notes" class="nav-link">üìã –í—Å–µ –∑–∞–º–µ—Ç–∫–∏</a>
                <a href="http://127.0.0.1:8000/users" class="nav-link">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
            </div>

            {% if notes %}
            <div class="notes-section">
                <h2>üìÑ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏</h2>
                <div class="notes-grid" id="notesGrid">
                    {% for note in notes %}
                    <div class="note-card" id="note-{{ note.id }}" data-note-id="{{ note.id }}">
                        <div class="note-header">
                            <div class="note-title">{{ note.title }}</div>
                            <div class="note-id">#{{ note.id }}</div>
                        </div>
                        <div class="note-content">
                            {{ note.content }}
                        </div>
                        <div class="note-actions">
                            <a href="http://127.0.0.1:8000/notes/{{ note.id }}/update" class="btn-edit">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                            <button type="button" class="btn-danger delete-note-btn" data-note-id="{{ note.id }}">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="empty-state">
                <p>üìù –ó–∞–º–µ—Ç–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</p>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // –ü–ª–∞–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
        document.addEventListener('DOMContentLoaded', function() {
            // –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫
            document.querySelectorAll('.delete-note-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const noteId = this.getAttribute('data-note-id');
                    const noteElement = document.getElementById('note-' + noteId);
                    
                    if (noteElement) {
                        // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
                        noteElement.style.animation = 'shake 0.5s ease, fadeOut 0.5s ease forwards';
                        
                        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                        setTimeout(() => {
                            fetch(`/notes/${noteId}/delete`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/x-www-form-urlencoded',
                                },
                            }).then(response => {
                                if (response.ok) {
                                    noteElement.remove();
                                    updateStats();
                                }
                            });
                        }, 500);
                    }
                });
            });

            // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ ID
            document.getElementById('deleteByIdForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const noteId = formData.get('note_id');
                
                fetch('/notes/deleteID', {
                    method: 'POST',
                    body: new URLSearchParams(formData),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                }).then(response => {
                    if (response.ok) {
                        const noteElement = document.getElementById('note-' + noteId);
                        if (noteElement) {
                            noteElement.style.animation = 'shake 0.5s ease, fadeOut 0.5s ease forwards';
                            setTimeout(() => {
                                noteElement.remove();
                                updateStats();
                                this.reset();
                            }, 500);
                        }
                    }
                });
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            function updateStats() {
                const noteCount = document.querySelectorAll('.note-card').length;
                const statNumber = document.querySelector('.stat-number');
                if (statNumber) {
                    statNumber.textContent = noteCount;
                    statNumber.style.animation = 'pulse 0.5s ease';
                    setTimeout(() => {
                        statNumber.style.animation = '';
                    }, 500);
                }
            }

            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('addNoteForm')?.addEventListener('submit', function(e) {
                const button = this.querySelector('button');
                button.classList.add('adding');
                setTimeout(() => {
                    button.classList.remove('adding');
                }, 1000);
            });
        });
    </script>
</body>
</html>